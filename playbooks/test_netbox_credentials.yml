---
- name: ğŸ” Teste de Credenciais NetBox
  hosts: localhost
  gather_facts: false
  become: false
  vars:
    ansible_connection: local
    netbox_url: "http://177.93.133.239:8000"
    netbox_token: "2e6be1f776b91aa3849dc3723632983e4a80443a"

  tasks:
    - name: ğŸ“Š Mostrar configuraÃ§Ã£o
      debug:
        msg:
          - "ğŸ”— NetBox URL: {{ netbox_url }}"
          - "ğŸ”‘ Token: {{ netbox_token[:8] }}...{{ netbox_token[-4:] }}"

    - name: ğŸŒ Testar conectividade NetBox
      uri:
        url: "{{ netbox_url }}/api/status/"
        method: GET
        headers:
          Authorization: "Token {{ netbox_token }}"
        validate_certs: false
        timeout: 10
      register: netbox_status
      failed_when: false

    - name: ğŸ“‹ Mostrar resultado do teste
      debug:
        msg:
          - "ğŸ“Š Status Code: {{ netbox_status.status | default('ERRO') }}"
          - "ğŸ“ Mensagem: {{ netbox_status.msg | default('N/A') }}"
          - "âœ… Conectividade: {{ 'OK' if (netbox_status.status | default(0)) == 200 else 'FALHOU' }}"
          - "ğŸ“„ Response: {{ netbox_status.json | default('N/A') }}"

    - name: âŒ Falhar se NetBox inacessÃ­vel
      fail:
        msg: "ğŸš« NetBox inacessÃ­vel: {{ netbox_status.msg | default('Erro desconhecido') }}"
      when: (netbox_status.status | default(0)) != 200

    - name: ğŸ‰ Teste concluÃ­do com sucesso
      debug:
        msg: "âœ… NetBox acessÃ­vel e funcionando!"